<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ page import="java.util.*, com.dao.MedicalRecordDAO, com.entity.MedicalRecord, com.Db.DBConnect" %>
<%
    int userId = 0;
    try {
        userId = Integer.parseInt(request.getParameter("userId"));
    } catch (Exception e) {
        out.println("<h4 style='color:red'>Invalid or missing userId parameter</h4>");
        return;
    }

    MedicalRecordDAO dao = new MedicalRecordDAO(DBConnect.getconn());
    List<MedicalRecord> records = dao.getAllRecordsByUser(userId);
%>
<html>
<head>
    <title>Medical Records</title>
    <%@include file="components/allCss.jsp"%>
</head>
<body>
<%@ include file="components/navBar.jsp"%>
<div class="container mt-4">
    <h3 class="mb-4">Medical Records for User ID: <%= userId %></h3>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Appointment ID</th>
                <th>File Name</th>
                <th>Uploaded Date</th>
                <th>View</th>
            </tr>
        </thead>
        <tbody>
            <%
                for (MedicalRecord rec : records) {
            %>
            <tr>
                <td><%= rec.getAppointmentId() %></td>
                <td><%= rec.getFileName() %></td>
                <td><%= rec.getUploadDate() %></td>
                <td>
                    <a href="<%= rec.getFilePath() %>" target="_blank" class="btn btn-primary btn-sm">View PDF</a>
                </td>
            </tr>
            <%
                }
                if (records.isEmpty()) {
            %>
            <tr>
                <td colspan="4" class="text-center">No medical records found.</td>
            </tr>
            <% } %>
        </tbody>
    </table>
</div>
</body>
</html>
